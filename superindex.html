<script>
  const numbersContainer = document.getElementById('numbers');
  const loadMoreBtn = document.getElementById('loadMoreBtn');
  let selectedNumbers = [];
  let currentMax = 0;
  let reservas = [];

  // URL do seu Apps Script publicado
  const scriptURL = 'https://script.google.com/macros/s/SEU_SCRIPT_ID/exec';

  async function fetchReservas() {
    try {
      const response = await fetch(scriptURL);
      reservas = await response.json();
      renderNumbers(1, 104);
    } catch (error) {
      alert('Erro ao buscar números reservados da planilha.');
      console.error(error);
    }
  }

  function renderNumbers(start, end) {
    for (let i = start; i <= end; i++) {
      const numberDiv = document.createElement('div');
      numberDiv.className = 'number';
      numberDiv.textContent = i.toString().padStart(3, '0');

      const reservado = reservas.find(r => r.numeros.includes(i));
      if (reservado) {
        numberDiv.classList.add('reserved');
        numberDiv.title = `Reservado por: ${reservado.nome}`;
      } else {
        numberDiv.onclick = () => toggleNumber(i, numberDiv);
      }

      numbersContainer.appendChild(numberDiv);
    }

    currentMax = end;
    if (currentMax >= 300) {
      loadMoreBtn.style.display = 'none';
    }
  }

  function loadMoreNumbers() {
    renderNumbers(currentMax + 1, Math.min(currentMax + 52, 300));
  }

  function toggleNumber(number, element) {
    if (selectedNumbers.includes(number)) {
      selectedNumbers = selectedNumbers.filter(n => n !== number);
      element.style.backgroundColor = '#efe5d8';
    } else {
      selectedNumbers.push(number);
      element.style.backgroundColor = '#d6cbb3';
    }
  }

  // Chamar a API da planilha ao carregar a página
  fetchReservas();
</script>
